# <h1 align="center">Downloading and processing tool for working with swissALTI3D data :triangular_ruler: :point_right: :file_folder:</h1>

This Python script downloads GeoTIFF files from a list of URLs generated by [swissALTI3D](https://www.swisstopo.admin.ch/de/hoehenmodell-swissalti3d "swissALTI3D"), merges them and optionally processes them.<br>


## Background :book:
The Swiss Federal Office of Topography swisstopo provides a great source for a digital elevation model (without vegetation and buildings). In my use case, working in an planning office in the field of infrastructure management, we use this data as part of our data validation process during the work on "Genereller EntwÃ¤sserungsplan (GEP)" (<i>en: General drainage planning GDP</i>) for various municipalities in Switzerland.  A practicable process for data acquisition and pre-processing to integrate the data in our tech stack was created with this tool.

# Usage
### Deployment :ship:
The script can be deployed inside a docker container. The needed files are provided. Before running docker compose configure the tool via the ```.env``` file (see [here](#configuration-gear)). There you can specify the folder path which you want to bind to the working directory.
```shell
docker compose up -d
```
### Export csv from swisstopo :outbox_tray:
First export a list of the relevant area on the website of [swissALTI3D](https://www.swisstopo.admin.ch/de/hoehenmodell-swissalti3d "swissALTI3D"). Use ```Cloud Optimized GeoTIFF``` as the format. Download the generated csv-file containing all the links for the specified tiles. Follow their terms of use.
### Workflow :pencil:
Copy the exported csv-file in to the ```input``` folder. <br>
The script constantly monitors the ```input``` folder inside the working directory. When a csv-file (export from swissALTI3D) is moved into the ```input``` folder, the script picks it up, creates a project folder named after the .csv-file (e.g. i use <i>city_name.csv</i>) downloads each GeoTIFF-files into the ```raw``` folder. After completion all single GeoTIFF files are merged into one (e.g. <i>city_name_merged.tif</i>) in the project directory. If the optional processing (```CONVERT_TO_XYZ```) is set to ```True```, the corresponding steps are executed.
### Result :clipboard:<br>
After completion you have a project folder containing the raw data as well as a merged GeoTIFF and optionally a conversion of that into an ASCII XYZ file.

Here is a representation of the folder srtructure.<br>
<pre>
ðŸ“¦alti3d-downloader
 â”£ ðŸ“‚input
 â”ƒ â”— ðŸ“˜  city_name.csv
 â”£ ðŸ“‚city_name
 â”ƒ â”£ ðŸ“‚raw
 â”ƒ â”ƒ â”£ ðŸ“— swissalti3d_[..].tif
 â”ƒ â”ƒ â”— ... 
 â”ƒ â”£ ðŸ“— city_name_merged.tif
 â”ƒ â”— ðŸ“— <i>city_name_merged.xyz</i>
 â”£ ðŸ“„ .dockerignore
 â”£ ðŸ“„ .env
 â”£ ðŸ“„ docker-compose.yml
 â”£ ðŸ“„ dockerfile
 â”£ ðŸ“„ download_manager.py
 â”£ ðŸ“„ readme.md
 â”— ðŸ“„ requirements.txt

 Legend: ðŸ“˜ input
         ðŸ“— output
 </pre>

## **Configuration :gear:**
### **.env :page_facing_up:**

All config parameters can be changed in the .env file.<br>
Define the working directory for the application using the ```DIR``` variable.<br>
```CONVERT_TO_XYZ``` enables/disables optional converting the final GeoTIFF to an ASCII XYZ file.

```python
#set working directory
DIR="../alti3d-downloader"
#optional conversion of the merged GeoTIFF
CONVERT_TO_XYZ=False #default is True
```

# Outlook :telescope:
![Necessity](https://img.shields.io/badge/Necessity-Undetermined-darkblue.svg)
adding downsampling option (swisstopo offers resolution in 0.5 m and 2 m) <br>
![Implementation](https://img.shields.io/badge/Implementation-researching-darkgreen.svg)
generating a TIN from raster data

# Appendix :books:
### XYZ Conversion
In our current techstack we need both file formats (.tif as well as .xyz).<br>
While swisstopo provides the option on their site to download .xyz files as well, to avoid double downloading raw data, a conversion is used.
The conversion is done by using gdal_translate. The following parameters are used:

```shell
gdal_translate -of XYZ -a_srs EPSG:2056 -co "DECIMAL_PRECISION=2"
```